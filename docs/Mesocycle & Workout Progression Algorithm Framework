Mesocycle & Workout Progression Algorithm Framework

Document Purpose
	1.	Define exact app progression logic
	2.	Create engineer-readable implementation guide
	3.	Provide LLM-ingestible framework for mesocycle generation

⸻

Section 1: Mesocycle Creation

User Inputs

Unchanging Inputs

What we store (stable):
	•	Biological profile data: biological_sex, date_of_birth, height_cm, weight_kg, dominant_hand, joint_hypermobility
	•	Long‑term preferences: desired_body_type, years_of_exercise_experience (buckets), training_background[], competition_style (raw/equipped), implants[], surgeries[] (structured), global_contraindications[], limitations[] (side/severity), units_preference

Notes / corrections applied:
	•	Kept dominant hand; it’s useful for unilateral defaults.
	•	Surgeries & limitations: captured as structured, fast chips + minimal notes (already defined).
	•	Safety: we’ll persist medical/contraindication fields before generating any program.

Changing Inputs

What we store (block/session specific):
	•	Session‑specific parameters: days_per_week (min 2, max 7), available_days[], minutes_per_session
	•	Current training variables: goal='hypertrophy', num_weeks (4–8), start_date, deload_week (defaults to last week)

Time‑tight definition (resolved):
	•	Final rule: time‑tight = (minutes_per_session ≤ 45) OR (days_per_week ≤ 3).
	•	If user explicitly chooses “short workouts”, treat as time‑tight even if minutes are higher that day.
	•	Your note “time‑tight threshold is >30 min” was contradictory; we standardized on ≤45 min (clear, evidence‑aligned).

Workout duration guidance:
	•	Design target ≈ 60 min, 75 min acceptable; user may build >120 min, but the generator will warn if projected time >90 min (fatigue/quality risk), not block.

⸻

Process

Exercise Selection Logic

Database filtering rules (primary, deterministic):
	•	Must pass all hard constraints: equipment available AND no violated contraindications AND not blacklisted.
	•	If user provided no equipment/injuries: Assumption (guardrailed): we fall back to a safe core set (bodyweight + cables + dumbbells + common machines). We do not assume “all equipment”; that creates unsafe barbell defaults.

Physiological prioritization (v1 scope):
	•	Emphasis: compounds first (your request), then machines/cables to complete volume.
	•	Ranking (kept minimal for v1): Tier (T1 > T2) → Stability demand (low preferred when time‑tight) → Setup time.
	•	Deferred (v2): explicit sfr_rank and long_length_bias weighting—keep fields in schema, default neutral.

Exercise sequencing principles (order & rests):
	•	Order: priority multi‑joint first → secondary compounds → isolations.
	•	Rests: ≥2 min compounds; ≥90 s isolations; extend if bar speed/technique decays.
	•	Touches/week: priority muscles 2–3, others 1–2.

Caps (resolved contradictions):
	•	Global algorithm caps: ≤8 sets/muscle/session, ≤24 sets/muscle/week.
	•	Workout Genie override (your product rule): ≤10 sets/muscle/session, ≤20 sets/week on auto‑generated plans only.
	•	Implement as config flags so engineers don’t fork logic.

Decision Waterfall
	1.	Primary filters: equipment ✓, contraindications ✓, blacklist ✓.
	2.	Secondary optimization: pick 2–3 exercises for priority muscles, 1–2 for others; tie‑break by user favorites if available.
	3.	Final assembly (volumes & targets):
	•	Starting set bands (weekly): Maintenance 4–6, Non‑priority 8–12, Priority 10–16.
	•	Rep ranges: compounds 8–12, isolations 10–15 (hypertrophy is similar across ~5–30 reps near failure).
	•	RIR targets (week scaffolding): see Section 2 “RIR progression”.
	•	Distribute sets across touches observing per‑session caps.
	•	Persist workouts → exercises → sets; cache per‑exercise week_plans (targets).

Duplicate/logic clean‑up:
	•	You listed both “per‑session cap 8” and “Workout Genie cap 10”; we kept 8 global, 10 Genie via config.
	•	You said “skip substitution cluster UI”; we keep clusters internally for safe suggestions, but do not render them.

⸻

User Outputs

Mesocycle Template Display
	•	Mesocycle name: auto‑populate Hypertrophy-{Priority1}/{Priority2} {Days}d x {Weeks}w into an editable name field.
	•	Training frequency: show selected days/week and map to available_days.
	•	Daily workout structure: 4–8 exercises/day; show order, sets × reps, RIR target, rest. Omit substitution cluster UI per your call.
	•	Physiological summary (brand voice): 3–4 sentences—volume bands, RIR plan, rest policy, deload week, “failure optional” line.

User Actions
	•	Exercise swapping: unlimited manual swaps; carry over targets; no auto‑swaps.
	•	Save & initiate: clicking Create writes the mesocycle as status='planning'. It flips to active on first workout start (prevents accidental “active” blocks).

⸻

Section 2: Workout Progression

Input Capture

Quantitative Inputs
	•	Per set: weight_kg, actual_reps (targets vs actuals).
	•	Optional: server‑computed e1RM anchor using submax + RIR correction (no 1RM testing needed).

Qualitative Inputs (Per Exercise)
	•	Effort rating (tap → RIR proxy): Easy≈≥4RIR, Medium≈2–3, Hard≈1–2, Brutal≈0–1.
	•	Pump (0–3): secondary; used for rep‑range/variant/set nudges (weekly).
	•	Joint pain (0–3): low‑sensitivity gate (v2) — overrides only on persistence or red‑flags.

⸻

Progression Logic

Within‑Session
	•	Keep it simple (your call): no intra‑session auto‑adjustments (no live +1 rep, no load edits). Safety stops still apply (Pain=3). All changes are computed after the workout.

Week‑to‑Week

1) RIR progression (by block length):
	•	4w: 3 → 2 → 1 (allow 0 on last key set) → Deload (RIR 4–6; −50% sets)
	•	5w: 3 → 2 → 2 → 1 (allow 0) → Deload
	•	6w: 3 → 3 → 2 → 2 → 1 (allow 0) → Deload
	•	7w: 3 → 3 → 2 → 2 → 1 → 1 (allow 0) → Deload (optional micro‑deload in W4: −20–30% vol, +2 RIR)
	•	8w: 3 → 3 → 2 → 2 → 1 → 1 → 1 (allow 0) → Deload (or 4 + micro‑deload + 3 + deload)

2) Volume modulation (auto‑reg):
	•	Add sets: if no fatigue flags and priority muscle <20 sets/wk, +2 sets next week (respect caps; split across touches).
	•	Cut sets: if any of these occur twice for that muscle: performance −≥2% at matched work, DOMS >72 h, Pain ≥Strong twice, or effort creep at same load/reps → −30–40% sets next week (local deload).
	•	Rate‑limit: one volume change per muscle per week.

3) Load incrementation (double progression):
	•	Your rule: when top of rep range is reached with ≥Medium effort (RIR ≥1), add +2.5% load (all lifts), round to nearest plate; reset reps to bottom of range.
	•	Otherwise, hold load and keep chasing rep ceiling.
	•	Older cohort: prefer smaller steps; microload when possible.

4) Pump logic (secondary; weekly):
	•	Pump 0 twice w/ Effort ≥Medium, Pain ≤Light → raise rep range or swap to continuous‑tension/long‑length variant; consider +1 set if under ceiling.
	•	Pump 3 + fatigue flag → −1–2 sets next week and +1 RIR buffer (local deload).
	•	Never tie load jumps to pump.

5) Pain logic (low‑sensitivity v2):
	•	Single pain blips do nothing to load/sets.
	•	Persistent Pain‑1 (3 in a row): next time −5% load, +1 RIR; no set change.
	•	Persistent Pain‑2 (2 in a row or 2/3): −5–7% load, +1 RIR, −1 set; consider safer variant if it persists again.
	•	Pain‑3 / red‑flag: stop that exercise today; next time −10%, +2 RIR, −1 set, safer variant for 1 exposure.
	•	Weekly deload for a muscle only if (Pain≥2 in ≥2 exercises) AND (perf− or DOMS>72 h) → −20% sets and +1 RIR for 1 week.

Mesocycle‑Level
	•	Periodization implementation: pre‑compute each week’s RIR targets & per‑muscle sets; cache in week_plans.
	•	Deload protocols: final week deload always; local deloads based on flags as above.
	•	Adaptation tracking: track reps @ given load and load @ given reps, plus effective sets (RIR ≤3 & technique ≥2) for dashboards—these do not gate progression.

⸻

Output Actions

Next Session Prescription
	•	Compute timing: after workout end only.
	•	Order of operations per exercise: Pain gate → (if no trigger) double progression (rep → load) → Pump/effort weekly nudges (rep‑range/variant/set) → Persist in week_plans.

Feedback Loops
	•	Fatigue management: If recovery_gate (soreness + pain) breaches thresholds or performance drops twice, show banner:
	•	“You’re carrying fatigue here. We’ve trimmed sets next week and raised the RIR target to keep quality high.”
	•	Progress indicators: weekly card per muscle—“+18 more quality reps completed” or “+2.5% load added on key set”—to reinforce adherence.

⸻

Implementation Notes
	•	Persistence (do now):
	1.	Save personalization hub to profiles (equipment[], injury_flags, years_of_exercise_experience, desired_body_type).
	2.	Persist effort, pump, joint_pain to workout_exercises.
	3.	Normalize workout_exercises.exercise_id to text exercise_uid across joins.
	•	Computation placement:
	•	Mesocycle creation → Edge Function (server truth).
	•	Next‑session prescription → client after workout end (migrate server‑side later).
	•	Weekly adaptation → Edge cron, writes week_plans.
	•	Library fields: keep tier, stability_demand; stub sfr_rank, long_length_bias but treat neutral in v1.
	•	Caps & bands (defaults): Maintenance 4–6, Non‑priority 8–12, Priority 10–16; global caps ≤24/wk, ≤8/session; Workout Genie caps ≤20/wk, ≤10/session via config.

⸻

Evidence Snapshots (for alignment)
	•	Dose–response to volume; diminishing returns at high sets. Schoenfeld et al., 2016.
	•	Hypertrophy across low–high loads when near failure; failure optional. Schoenfeld et al., 2017; Grgic et al., 2021.
	•	Training frequency: small effect when weekly volume is equated—use it to distribute sets. Schoenfeld et al., 2019.
	•	Longer rests (≥2 min compounds) preserve output and can enhance hypertrophy vs short rests. Schoenfeld et al., 2016.
	•	RIR/RPE mapping is practical for prescription and autoregulation. Zourdos/Helms 2016.
	•	Sex differences in fatigability exist; apply as conservative ceilings, not hard rules. Hunter 2016.

(Use your existing PubMed links; no new UI exposure required.)

⸻

Explicit Assumptions
	1.	Time‑tight defined as ≤45 min or ≤3 d/wk; a “short workouts” flag forces time‑tight behavior.
	2.	No intra‑session auto‑changes (except safety stops). All adjustments apply to the next session.
	3.	Load steps: global +2.5% when rep ceiling met (round to plates; microload when available).
	4.	Workout Genie uses stricter caps (≤20/wk, ≤10/session) than global defaults; implemented as config.
	5.	If equipment/injuries are unset, we default to a safe core equipment profile, not “all equipment”.

⸻

This document aligns product, physiology, and engineering: clear inputs, deterministic selection, simple caps, RIR scaffolding by block length, end‑of‑workout progression computation, and conservative pain/pump gates—all optimized for older, hypertrophy‑oriented users without 1RM testing.
